<!DOCTYPE html>
<html>
<head>
    <title>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø·Ù„Ø§</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: Tahoma; 
            direction: rtl;
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            margin: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .price { font-size: 24px; color: #d4af37; }
        .signal-buy { color: green; font-weight: bold; }
        .signal-sell { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ’° Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒØ¯Ù‡ÛŒ Ø·Ù„Ø§</h1>
        <div id="price" class="price">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</div>
        <div id="signal">Ø³ÛŒÚ¯Ù†Ø§Ù„: -</div>
        <div id="time">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: -</div>
        <button onclick="refreshData()" style="margin: 10px; padding: 10px;">
            ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
        </button>
    </div>

    <script>
        // Ú©Ø¯Ù‡Ø§ÛŒ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡
        let priceList = [];
        const emaShortLen = 5;
        const emaLongLen = 13;

        // ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ EMA
        function calculateEMA(prices, period) {
            let k = 2 / (period + 1);
            let ema = [prices[0]];
            for (let i = 1; i < prices.length; i++) {
                ema[i] = prices[i] * k + ema[i-1] * (1 - k);
            }
            return ema;
        }

        // ØªØ§Ø¨Ø¹ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª
        async function getGoldPrice() {
            try {
                // Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§Ø² ÛŒÚ© API Ø³Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                const response = await fetch('https://api.metals.live/v1/spot/gold');
                const data = await response.json();
                return data[0]?.price || (1800 + Math.random() * 100);
            } catch (error) {
                // Ø§Ú¯Ø± API Ø¬ÙˆØ§Ø¨ Ù†Ø¯Ø§Ø¯ØŒ Ù‚ÛŒÙ…Øª ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†
                return (1800 + Math.random() * 100).toFixed(2);
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØµÙØ­Ù‡
        function updateDisplay(price, signal) {
            document.getElementById('price').textContent = `Ù‚ÛŒÙ…Øª: $${price}`;
            document.getElementById('signal').textContent = `Ø³ÛŒÚ¯Ù†Ø§Ù„: ${signal || '-'}`;
            document.getElementById('signal').className = signal === 'BUY' ? 'signal-buy' : 
                                                         signal === 'SELL' ? 'signal-sell' : '';
            document.getElementById('time').textContent = `Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${new Date().toLocaleTimeString('fa-IR')}`;
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
        async function refreshData() {
            const price = parseFloat(await getGoldPrice());
            priceList.push(price);
            
            // Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡ Ú©Ø§ÙÛŒ Ø¯Ø§Ø±ÛŒÙ…ØŒ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†
            let signal = null;
            if (priceList.length >= emaLongLen) {
                const shortEMA = calculateEMA(priceList, emaShortLen);
                const longEMA = calculateEMA(priceList, emaLongLen);
                
                const last = priceList.length - 1;
                if (shortEMA[last] > longEMA[last] && shortEMA[last-1] <= longEMA[last-1]) {
                    signal = 'BUY';
                } else if (shortEMA[last] < longEMA[last] && shortEMA[last-1] >= longEMA[last-1]) {
                    signal = 'SELL';
                }
            }
            
            updateDisplay(price, signal);
            
            // Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
            if (signal) {
                if (Notification.permission === 'granted') {
                    new Notification(`Ø³ÛŒÚ¯Ù†Ø§Ù„ ${signal}`, {
                        body: `Ù‚ÛŒÙ…Øª: $${price}`,
                        icon: 'https://cdn-icons-png.flaticon.com/512/3138/3138314.png'
                    });
                }
            }
        }

        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯
        window.onload = function() {
            // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            refreshData();
            
            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡
            setInterval(refreshData, 5 * 60 * 1000);
        };
    </script>
</body>
</html>
